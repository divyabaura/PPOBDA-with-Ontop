# PPOBDA-with-Ontop

This project implements **Conditional Query Expansion (CQE)** using the capabilities of the open-source Ontology-Based Data Access (OBDA) system, **Ontop**. The purpose is to expand policies with respect to ontologies and generate mappings that comply with the defined policies.

## Prerequisites

- Java Development Kit (JDK) installed
- Ontop OBDA system

## Project Structure

- **mapgen/**: Contains the `Main.java` and `PolicyExpander.java` functions.
- **ppmappingcompiler/**: Contains the `PPOBDAMappingCompiler.java` function.
- **example/**: Contains sample data, including ontology, mapping, database schema, and policy files.

## Steps to Follow

### Step 1: Generate Direct Mappings

First, we need to create direct mappings from a dummy database to the ontology. This step simulates a data source for Ontop.

1. **Run `Main.java`:** 
   - This Java function generates direct mappings by establishing one-to-one mappings from the dummy database to the ontology.
   - The generated mappings act as a simulated data source, which Ontop will use for query rewriting.

### Step 2: Expand Policies with Ontology

Next, we need to use the Ontop reasoner to rewrite the policies with respect to the ontology.

1. **Run `PolicyExpander.java`:**
   - This function takes user-defined policies (P) as queries.
   - It activates the Ontop reasoner, using the direct mappings from Step 1 as a connection between the data source and the ontology.
   - This process results in policy rewriting, expanding the policies with respect to the ontology.

### Step 3: Compile Rewritten Queries to SPARQL

Now that we have the expanded policies, we need to redefine them as SPARQL queries.

1. **Run `PPOBDAMappingCompiler.java`:**
   - This function compiles the rewritten queries (expanded policies) into SPARQL queries.
   - Each predicate, including negations for atoms that violate the policy, is transformed into a SPARQL query.

### Step 4: Convert SPARQL Queries to SQL

Next, convert the SPARQL queries into SQL queries using Ontop's query engine.

1. **Run `PolicyEmbed.java`:**
   - This function processes the SPARQL queries and the ontology to convert them into SQL queries.
   - A new mapping is created with these SQL queries as the source for each respective predicate in the target OBDA file.
   - This step effectively encodes the mappings with the existing policy.

### Step 5: Validate with Example

Finally, validate the entire process using the provided example data.

1. **Use the `example/` folder:**
   - The example includes a University data ontology, mapping, database schema, and a policy file.
   - The policy specifies confidential information, such as student data with the country as "Belgium".
   - Follow the above steps using the provided example data to generate new mappings compliant with the policy.
   - The final output file from the `PolicyExpander` function will contain the compliant mappings.

## Example

The `example/` folder contains an example of university data information, where a policy specifies that student information with the country "Belgium" is confidential. Follow the above steps with the given example of ontology, mapping, and database schema, and execute the Java functions by providing the required inputs to generate the new mappings compliant with the policy. 

## Output

- The final output is generated by the `PolicyExpander.java` function. It provides the new mappings that comply with the specified policy.

## Contact

For any questions or further information, please contact:

Divya Baura  
Email: [divya.baura@umu.se](mailto:divya.baura@umu.se)

